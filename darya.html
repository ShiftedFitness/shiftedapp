<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Darya • Shifted Fitness</title>
  <style>html,body{height:100%;margin:0;background:#000;}</style>

  <script>
  // ---------- 1) HARDCODED TEST VALUES (change these) ----------
  const NAME   = "Taylor";
  const MOVE   = "Romanian Deadlift";
  const INTENT = "wants_feedback";
  const CONTEXT= "";

  const INTRO =
    (INTENT === "wants_feedback" && MOVE)
      ? `Hello ${NAME || 'there'}, so you need some help with the ${MOVE}. No worries — I've got you covered.`
      : (NAME ? `Hi ${NAME}! How can I help today?` : `Hi! What can I help you with today?`);

  // ---------- 2) BOOTSTRAP CHATBASE STUB ----------
  (function(){
    if(!window.chatbase || window.chatbase("getState")!=="initialized"){
      window.chatbase = (...args)=>{ (window.chatbase.q = window.chatbase.q || []).push(args); };
      window.chatbase = new Proxy(window.chatbase,{
        get(target,prop){ if(prop==="q"){return target.q} return (...a)=>target(prop,...a) }
      });
    }

    // ---------- 3) QUEUE PERSONALIZATION *BEFORE* WIDGET LOADS ----------
    window.chatbase("setInitialMessages", [INTRO, CONTEXT ? `Context: ${CONTEXT}` : undefined].filter(Boolean));
    window.chatbase("identify", {
      user_id: NAME || undefined,
      metadata: { name: NAME || undefined, move: MOVE || undefined, intent: INTENT || undefined, context: CONTEXT || undefined, source: "Adalo WebView" }
    });
    window.chatbase("open"); // auto-expand on load

    // ---------- 4) LOAD THE WIDGET ----------
    const onLoad = function(){
      const script = document.createElement("script");
      script.src = "https://www.chatbase.co/embed.min.js";
      script.id  = "qZ1zajTDomWA0ko7xP5MK"; // <-- your bot id must be correct
      script.domain = "www.chatbase.co";
      document.body.appendChild(script);
    };
    if(document.readyState==="complete"){ onLoad() } else { window.addEventListener("load", onLoad) }
  })();
  </script>
</head>
<body></body>
</html>
