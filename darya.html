<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Darya • Shifted Fitness</title>
  <style>
    html,body { height:100%; margin:0; background:#000; }
  </style>

  <!-- Chatbase Bubble Embed (YOUR snippet) -->
  <script>
  (function(){
    if(!window.chatbase || window.chatbase("getState")!=="initialized"){
      window.chatbase = (...arguments)=>{
        if(!window.chatbase.q){ window.chatbase.q=[] }
        window.chatbase.q.push(arguments)
      };
      window.chatbase = new Proxy(window.chatbase,{
        get(target,prop){ if(prop==="q"){return target.q} return (...args)=>target(prop,...args) }
      });
    }
    const onLoad=function(){
      const script=document.createElement("script");
      script.src="https://www.chatbase.co/embed.min.js";
      script.id="qZ1zajTDomWA0ko7xP5MK"; /* <-- your bot id */
      script.domain="www.chatbase.co";
      document.body.appendChild(script);
    };
    if(document.readyState==="complete"){ onLoad() } else { window.addEventListener("load",onLoad) }
  })();
  </script>
</head>
<body>

<script>
  /* ---------- HARDCODED TEST VALUES ---------- */
  const name   = "Taylor";
  const move   = "Romanian Deadlift";
  const intent = "wants_feedback";
  const context= ""; // optional

  const intro =
    (intent === 'wants_feedback' && move)
      ? `Hello ${name || 'there'}, so you need some help with the ${move}. No worries — I've got you covered.`
      : (name ? `Hi ${name}! How can I help today?` : `Hi! What can I help you with today?`);

  function personalizeAndOpen(){
    // 1) personalize greeting
    if (typeof window.chatbase?.setInitialMessages === 'function') {
      const msgs = [intro];
      if (context) msgs.push(`Context: ${context}`);
      window.chatbase.setInitialMessages(msgs);
    }
    // 2) attach lightweight metadata
    if (typeof window.chatbase === 'function') {
      window.chatbase('identify', {
        user_id: name || undefined,
        metadata: { name, move, intent, context, source: 'Adalo WebView (hardcoded test)' }
      });
    }
    // 3) AUTO-OPEN the chat (expanded, not just a bubble)
    if (typeof window.chatbase === 'function') {
      window.chatbase('open');   // try to open once
      setTimeout(()=>window.chatbase('open'), 400);   // nudge again in case first call is early
      setTimeout(()=>window.chatbase('open'), 1000);  // final nudge
    }
  }

  // Wait for the Chatbase widget API to be ready, then personalize + open
  const readyTimer = setInterval(()=>{
    if (typeof window.chatbase?.setInitialMessages === 'function') {
      clearInterval(readyTimer);
      personalizeAndOpen();
    }
  }, 200);
</script>

</body>
</html>
